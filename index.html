<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a0a0a">
    <meta name="format-detection" content="telephone=no">
    <title>–¢–≤–æ–π –ì–æ—Ç–∏—á–µ—Å–∫–∏–π –î–µ–º–æ–Ω-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a0a0a 0%, #2d1b1b 100%);
            color: #e0d5c7;
            overflow: hidden;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        /* Header */
        .header {
            background: rgba(20, 10, 10, 0.95);
            padding: 15px 20px;
            padding-top: calc(15px + env(safe-area-inset-top));
            border-bottom: 2px solid #8b0000;
            box-shadow: 0 4px 20px rgba(139, 0, 0, 0.3);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .demon-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b0000, #dc143c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid #ff4444;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }

        .user-info {
            flex: 1;
            margin-left: 15px;
        }

        .user-name {
            font-size: 18px;
            font-weight: bold;
            color: #ff6666;
        }

        .user-level {
            font-size: 12px;
            color: #999;
        }

        .blood-points {
            background: rgba(139, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #8b0000;
            font-size: 14px;
            font-weight: bold;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(30, 15, 15, 0.9);
            border-bottom: 1px solid #8b0000;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            flex-shrink: 0;
        }

        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 10px;
            text-align: center;
            border: none;
            background: transparent;
            color: #999;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #ff6666;
            border-bottom-color: #8b0000;
            background: rgba(139, 0, 0, 0.2);
        }

        .nav-tab:active {
            transform: scale(0.95);
        }

        /* Screen Container */
        .screen-container {
            flex: 1;
            overflow: hidden;
            position: relative;
            touch-action: pan-y;
            min-height: 0;
        }

        .screen {
            display: none;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            -webkit-overflow-scrolling: touch;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Demon Message Box */
        .demon-message {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.3), rgba(220, 20, 60, 0.2));
            border: 2px solid #8b0000;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
        }

        .demon-message::before {
            content: 'üëπ';
            position: absolute;
            top: -15px;
            left: 15px;
            font-size: 30px;
            background: #1a0a0a;
            padding: 5px;
            border-radius: 50%;
        }

        .demon-message p {
            margin-top: 10px;
            line-height: 1.6;
            font-size: 14px;
        }

        /* Quest Card */
        .quest-card {
            background: rgba(40, 20, 20, 0.8);
            border: 2px solid #8b0000;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s;
        }

        .quest-card:active {
            transform: scale(0.98);
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quest-title {
            font-size: 16px;
            font-weight: bold;
            color: #ff6666;
        }

        .quest-timer {
            background: rgba(139, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #ffaaaa;
        }

        .quest-description {
            font-size: 13px;
            color: #ccc;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .quest-hint {
            font-size: 11px;
            color: #999;
            font-style: italic;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid #8b0000;
        }

        .quest-reward {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid rgba(139, 0, 0, 0.3);
        }

        .reward-text {
            font-size: 12px;
            color: #ff9966;
        }

        .quest-complete-btn {
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quest-complete-btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }

        .quest-complete-btn.completed {
            background: #333;
            color: #666;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            margin: 20px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b0000;
        }

        .section-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #ff6666;
        }

        /* Input Fields */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .input-field {
            width: 100%;
            background: rgba(40, 20, 20, 0.6);
            border: 2px solid #8b0000;
            border-radius: 10px;
            padding: 12px;
            color: #e0d5c7;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }

        .input-field:focus {
            outline: none;
            border-color: #dc143c;
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.3);
        }

        /* Buttons */
        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .btn-primary:active {
            transform: scale(0.98);
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }

        /* Financial Dashboard */
        .finance-card {
            background: linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(50, 25, 25, 0.8));
            border: 2px solid #8b0000;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .finance-amount {
            font-size: 32px;
            font-weight: bold;
            color: #ff6666;
            text-align: center;
            margin: 10px 0;
        }

        .finance-label {
            text-align: center;
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
        }

        .piggy-bank {
            background: rgba(40, 20, 20, 0.6);
            border: 2px solid #8b0000;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .piggy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .piggy-name {
            font-size: 14px;
            font-weight: bold;
            color: #ff9966;
        }

        .piggy-amount {
            font-size: 14px;
            color: #66ff66;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b0000, #dc143c);
            transition: width 0.5s;
            border-radius: 10px;
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: rgba(40, 20, 20, 0.6);
            border: 1px solid #8b0000;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day:active {
            transform: scale(0.95);
            background: rgba(139, 0, 0, 0.3);
        }

        .calendar-day.has-booking {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.5), rgba(220, 20, 60, 0.3));
            border-color: #dc143c;
        }

        .calendar-day-num {
            font-size: 14px;
            font-weight: bold;
        }

        .calendar-day-dot {
            width: 4px;
            height: 4px;
            background: #ff6666;
            border-radius: 50%;
            margin-top: 2px;
        }

        /* Rewards */
        .reward-item {
            background: rgba(40, 20, 20, 0.6);
            border: 2px solid #8b0000;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reward-info {
            flex: 1;
        }

        .reward-name {
            font-size: 14px;
            font-weight: bold;
            color: #ff9966;
            margin-bottom: 5px;
        }

        .reward-price {
            font-size: 12px;
            color: #66ff66;
        }

        .reward-status {
            font-size: 12px;
            color: #999;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        /* Diary */
        .diary-entry {
            background: rgba(40, 20, 20, 0.8);
            border: 2px solid #8b0000;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .diary-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
        }

        .diary-content {
            font-size: 14px;
            line-height: 1.6;
            color: #e0d5c7;
        }

        /* Mood Selector */
        .mood-selector {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .mood-btn {
            width: 50px;
            height: 50px;
            background: rgba(40, 20, 20, 0.6);
            border: 2px solid #8b0000;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mood-btn:active, .mood-btn.selected {
            transform: scale(1.1);
            border-color: #dc143c;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }

        /* Bottom Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(150%);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
        }

        /* Quest Tabs */
        .quest-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .quest-tab-btn {
            background: rgba(40, 20, 20, 0.6);
            border: 2px solid #8b0000;
            color: #999;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quest-tab-btn.active {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.5), rgba(220, 20, 60, 0.3));
            border-color: #dc143c;
            color: #ff6666;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a0a0a, #2d1b1b);
            border: 2px solid #8b0000;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #ff6666;
        }

        .modal-close {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: #8b0000;
            border-radius: 10px;
        }

        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #8b0000, #dc143c);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 999;
        }

        .install-prompt.show {
            display: block;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="demon-avatar">üòà</div>
                <div class="user-info">
                    <div class="user-name">–ê–Ω—Ç–æ–Ω</div>
                    <div class="user-level">–¢–∞—Ç—É-–º–∞—Å—Ç–µ—Ä ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å 5</div>
                </div>
                <div class="blood-points">
                    ü©∏ <span id="bloodPoints">0</span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-screen="quests">‚öîÔ∏è –ó–∞–¥–∞–Ω–∏—è</button>
            <button class="nav-tab" data-screen="finance">üí∞ –§–∏–Ω–∞–Ω—Å—ã</button>
            <button class="nav-tab" data-screen="calendar">üìÖ –ó–∞–ø–∏—Å–∏</button>
            <button class="nav-tab" data-screen="diary">üìî –î–Ω–µ–≤–Ω–∏–∫</button>
            <button class="nav-tab" data-screen="rewards">üéÅ –ù–∞–≥—Ä–∞–¥—ã</button>
            <button class="nav-tab" data-screen="stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <!-- Screens Container -->
        <div class="screen-container">
            
            <!-- Quests Screen -->
            <div class="screen active" id="quests">
                <div class="demon-message">
                    <p><strong>–°–ª—É—à–∞–π —Å—é–¥–∞, —Ç–≤–æ—Ä–µ—Ü –∫–æ–∂–Ω—ã—Ö –∫–æ—à–º–∞—Ä–æ–≤!</strong></p>
                    <p>–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –¥–µ–º–æ–Ω-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫, –∏ —Å–µ–≥–æ–¥–Ω—è –º—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏–º —Ç–≤–æ—é –∂–∏–∑–Ω—å –∏–∑ —Ö–∞–æ—Ç–∏—á–Ω–æ–≥–æ –¥–µ—Ä—å–º–∞ –≤ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ä—å–º–æ. –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫—Ä–æ–≤–∞–≤—ã–µ –æ—á–∫–∏, –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å ‚Äì –ú–û–ñ–ï–¢ –ë–´–¢–¨ ‚Äì —Ç—ã –Ω–∞–∫–æ–Ω–µ—Ü –≤—ã–ø–æ–ª–∑–µ—à—å –∏–∑ —ç—Ç–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —è–º—ã.</p>
                </div>

                <div class="quest-tabs">
                    <button class="quest-tab-btn active" data-period="4h">‚è∞ –ö–∞–∂–¥—ã–µ 4 —á–∞—Å–∞</button>
                    <button class="quest-tab-btn" data-period="daily">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ</button>
                    <button class="quest-tab-btn" data-period="weekly">üìÜ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ</button>
                </div>

                <div id="questsList">
                    <!-- Quests will be generated here -->
                </div>
            </div>

            <!-- Finance Screen -->
            <div class="screen" id="finance">
                <div class="demon-message">
                    <p><strong>–¢–≤–æ–∏ –∂–∞–ª–∫–∏–µ —Ñ–∏–Ω–∞–Ω—Å—ã, —Å–º–µ—Ä—Ç–Ω—ã–π!</strong></p>
                    <p>–î–∞–≤–∞–π-–∫–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –Ω–∞ —á—Ç–æ —Ç—ã —Å–ø—É—Å–∫–∞–µ—à—å —Å–≤–æ–∏ –∫—Ä–æ–≤–Ω—ã–µ... –ù–∞–¥–µ—é—Å—å, –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –∏–≥—Ä—ã –∏ —Ç–∞—Ç—É–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∏–≥–ª—ã.</p>
                </div>

                <div class="finance-card">
                    <div class="finance-label">üí∏ –ë–∞–ª–∞–Ω—Å —Å–µ–≥–æ–¥–Ω—è</div>
                    <div class="finance-amount"><span id="currentBalance">0</span> z≈Ç</div>
                </div>

                <div class="section-header">
                    <span class="section-icon">üè∫</span>
                    <span class="section-title">–¢–≤–æ–∏ –ö–æ–ø–∏–ª–∫–∏</span>
                </div>

                <div id="piggyBanksList">
                    <!-- Piggy banks will be generated here -->
                </div>

                <div class="section-header">
                    <span class="section-icon">üí≥</span>
                    <span class="section-title">–î–æ–±–∞–≤–∏—Ç—å –î–æ—Ö–æ–¥</span>
                </div>

                <div class="input-group">
                    <label class="input-label">–°—É–º–º–∞ (z≈Ç)</label>
                    <input type="number" class="input-field" id="incomeAmount" placeholder="0">
                </div>

                <div class="input-group">
                    <label class="input-label">–ò—Å—Ç–æ—á–Ω–∏–∫</label>
                    <select class="input-field" id="incomeSource">
                        <option value="warsaw">üíº –°–µ—Å—Å–∏—è –í–∞—Ä—à–∞–≤–∞</option>
                        <option value="sochaczew">üöó –°–µ—Å—Å–∏—è –°–æ—Ö–∞—á–µ–≤</option>
                        <option value="other">üíµ –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>

                <button class="btn-primary" onclick="addIncome()">üí∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –î–æ—Ö–æ–¥</button>

                <div class="section-header">
                    <span class="section-icon">üí∏</span>
                    <span class="section-title">–ó–∞–ø–∏—Å–∞—Ç—å –†–∞—Å—Ö–æ–¥</span>
                </div>

                <div class="input-group">
                    <label class="input-label">–°—É–º–º–∞ (z≈Ç)</label>
                    <input type="number" class="input-field" id="expenseAmount" placeholder="0">
                </div>

                <div class="input-group">
                    <label class="input-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="input-field" id="expenseCategory">
                        <option value="rent">üè† –ê—Ä–µ–Ω–¥–∞</option>
                        <option value="food">üçï –ï–¥–∞</option>
                        <option value="transport">üöå –î–æ—Ä–æ–≥–∞</option>
                        <option value="medicine">üíä –õ–µ–∫–∞—Ä—Å—Ç–≤–∞</option>
                        <option value="doctor">üë®‚Äç‚öïÔ∏è –í—Ä–∞—á</option>
                        <option value="debt">üìâ –î–æ–ª–≥–∏</option>
                        <option value="education">üìö –û–±—É—á–µ–Ω–∏–µ</option>
                        <option value="other">üí≥ –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–ó–∞–º–µ—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <input type="text" class="input-field" id="expenseNote" placeholder="–ù–∞ —á—Ç–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª?">
                </div>

                <button class="btn-primary" onclick="addExpense()">üí∏ –ó–∞–ø–∏—Å–∞—Ç—å –†–∞—Å—Ö–æ–¥</button>
            </div>

            <!-- Calendar Screen -->
            <div class="screen" id="calendar">
                <div class="demon-message">
                    <p><strong>–¢–≤–æ—è –∫–Ω–∏–≥–∞ –∑–∞–ø–∏—Å–µ–π, —Ö—É–¥–æ–∂–Ω–∏–∫!</strong></p>
                    <p>–ó–¥–µ—Å—å —Ç—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—à—å, –∫–æ–≥–¥–∞ –∫–∞–ª–µ—á–∏—à—å... —Ç–æ –µ—Å—Ç—å —É–∫—Ä–∞—à–∞–µ—à—å —Ç–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –ù–µ –∑–∞–±—ã–≤–∞–π –æ—Ç–º–µ—á–∞—Ç—å –≥–æ—Ä–æ–¥, —á—Ç–æ–±—ã —è –º–æ–≥ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç—ã —Ç–µ—Ä—è–µ—à—å –Ω–∞ –¥–æ—Ä–æ–≥–µ –≤ —ç—Ç–æ—Ç —á–µ—Ä—Ç–æ–≤ –°–æ—Ö–∞—á–µ–≤.</p>
                </div>

                <div class="section-header">
                    <span class="section-icon">üìÖ</span>
                    <span class="section-title">–ù–æ—è–±—Ä—å 2025</span>
                </div>

                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>

                <button class="btn-primary" onclick="showBookingModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ó–∞–ø–∏—Å—å</button>
            </div>

            <!-- Diary Screen -->
            <div class="screen" id="diary">
                <div class="demon-message">
                    <p><strong>–í—Ä–µ–º—è –∏—Å–ø–æ–≤–µ–¥–∏, –≥—Ä–µ—à–Ω–∏–∫!</strong></p>
                    <p>–†–∞—Å—Å–∫–∞–∂–∏ —Å–≤–æ–µ–º—É –¥–µ–º–æ–Ω—É, –∫–∞–∫ –ø—Ä–æ—à–µ–ª –¥–µ–Ω—å. –ò –Ω–µ –≤–∑–¥—É–º–∞–π –≤—Ä–∞—Ç—å ‚Äì —è –≤—Å–µ —Ä–∞–≤–Ω–æ –≤–∏–∂—É —Ç–≤–æ–∏ —à–∞–≥–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã.</p>
                </div>

                <div class="section-header">
                    <span class="section-icon">üìù</span>
                    <span class="section-title">–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –ó–∞–ø–∏—Å—å</span>
                </div>

                <div class="input-group">
                    <label class="input-label">–ö–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?</label>
                    <div class="mood-selector">
                        <button class="mood-btn" data-mood="terrible" onclick="selectMood('terrible')">üò≠</button>
                        <button class="mood-btn" data-mood="bad" onclick="selectMood('bad')">üòî</button>
                        <button class="mood-btn" data-mood="okay" onclick="selectMood('okay')">üòê</button>
                        <button class="mood-btn" data-mood="good" onclick="selectMood('good')">üôÇ</button>
                        <button class="mood-btn" data-mood="great" onclick="selectMood('great')">üòÑ</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤</label>
                    <input type="number" class="input-field" id="stepsInput" placeholder="–í–Ω–µ—Å–∏ –¥–∞–Ω–Ω—ã–µ —Å —á–∞—Å–æ–≤">
                </div>

                <div class="input-group">
                    <label class="input-label">–ß—Ç–æ —Å–¥–µ–ª–∞–ª —Å–µ–≥–æ–¥–Ω—è?</label>
                    <textarea class="input-field" id="diaryText" rows="5" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ–µ–º –¥–Ω–µ..."></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–£—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏ (1-10)</label>
                    <input type="range" class="input-field" id="anxietyLevel" min="1" max="10" value="5">
                    <div style="text-align: center; color: #ff6666; font-size: 24px; margin-top: 10px;">
                        <span id="anxietyDisplay">5</span>/10
                    </div>
                </div>

                <button class="btn-primary" onclick="saveDiary()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ó–∞–ø–∏—Å—å</button>

                <div class="section-header">
                    <span class="section-icon">üìñ</span>
                    <span class="section-title">–ò—Å—Ç–æ—Ä–∏—è –ó–∞–ø–∏—Å–µ–π</span>
                </div>

                <div id="diaryHistory">
                    <!-- Diary entries will be shown here -->
                </div>
            </div>

            <!-- Rewards Screen -->
            <div class="screen" id="rewards">
                <div class="demon-message">
                    <p><strong>–¢–≤–æ–π —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π, –∂–∞–¥–∏–Ω–∞!</strong></p>
                    <p>–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –æ—Ç–º–µ—Ç–∏—Ç—å, –∫–∞–∫–∏–µ –±–ª–∞–≥–∞ —Ç—ã —Ö–æ—á–µ—à—å —Å–µ–±–µ –∫—É–ø–∏—Ç—å. –Ø –±—É–¥—É –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—Ç—å, –∫–æ–≥–¥–∞ —Ç—ã —Å–º–æ–∂–µ—à—å —Å–µ–±–µ —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç—å. –°–ø–æ–π–ª–µ—Ä: –Ω–µ—Å–∫–æ—Ä–æ.</p>
                </div>

                <button class="btn-primary" onclick="showAddRewardModal()">üéÅ –î–æ–±–∞–≤–∏—Ç—å –ù–∞–≥—Ä–∞–¥—É</button>

                <div id="rewardsList">
                    <!-- Rewards will be shown here -->
                </div>
            </div>

            <!-- Stats Screen -->
            <div class="screen" id="stats">
                <div class="demon-message">
                    <p><strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–≤–æ–∏—Ö —Å—Ç—Ä–∞–¥–∞–Ω–∏–π!</strong></p>
                    <p>–í–æ—Ç –∫–∞–∫ —Ç—ã –ø—Ä–æ–¥–≤–∏–≥–∞–µ—à—å—Å—è –∫ —Å–≤–æ–∏–º —Ü–µ–ª—è–º. –¶–∏—Ñ—Ä—ã –Ω–µ –≤—Ä—É—Ç, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–µ–±—è.</p>
                </div>

                <div class="section-header">
                    <span class="section-icon">üìà</span>
                    <span class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –ù–µ–¥–µ–ª—é</span>
                </div>

                <div class="finance-card">
                    <div class="finance-label">üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                    <div class="finance-amount"><span id="weekIncome">0</span> z≈Ç</div>
                </div>

                <div class="finance-card">
                    <div class="finance-label">üí∏ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                    <div class="finance-amount"><span id="weekExpense">0</span> z≈Ç</div>
                </div>

                <div class="finance-card">
                    <div class="finance-label">‚öîÔ∏è –ó–∞–¥–∞–Ω–∏–π –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    <div class="finance-amount"><span id="questsCompleted">0</span></div>
                </div>

                <div class="finance-card">
                    <div class="finance-label">üëü –°—Ä–µ–¥–Ω–∏–µ –®–∞–≥–∏/–î–µ–Ω—å</div>
                    <div class="finance-amount"><span id="avgSteps">0</span></div>
                </div>

                <div class="section-header">
                    <span class="section-icon">üéØ</span>
                    <span class="section-title">–ì–ª–∞–≤–Ω—ã–µ –¶–µ–ª–∏</span>
                </div>

                <div class="piggy-bank">
                    <div class="piggy-header">
                        <span class="piggy-name">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ü–æ–¥—É—à–∫–∞</span>
                        <span class="piggy-amount"><span id="cushionAmount">0</span> / 5000 z≈Ç</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cushionProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="piggy-bank">
                    <div class="piggy-header">
                        <span class="piggy-name">üìâ –î–æ–ª–≥–∏</span>
                        <span class="piggy-amount"><span id="debtPaid">0</span> z≈Ç –≤—ã–ø–ª–∞—á–µ–Ω–æ</span>
                    </div>
                </div>

                <button class="btn-primary" onclick="generateWeeklyReport()">üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –û—Ç—á–µ—Ç</button>
            </div>

        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">–ù–æ–≤–∞—è –ó–∞–ø–∏—Å—å</span>
                <button class="modal-close" onclick="closeModal('bookingModal')">‚úï</button>
            </div>

            <div class="input-group">
                <label class="input-label">–î–∞—Ç–∞</label>
                <input type="date" class="input-field" id="bookingDate">
            </div>

            <div class="input-group">
                <label class="input-label">–í—Ä–µ–º—è</label>
                <input type="time" class="input-field" id="bookingTime">
            </div>

            <div class="input-group">
                <label class="input-label">–ì–æ—Ä–æ–¥</label>
                <select class="input-field" id="bookingCity">
                    <option value="warsaw">üèôÔ∏è –í–∞—Ä—à–∞–≤–∞</option>
                    <option value="sochaczew">üöó –°–æ—Ö–∞—á–µ–≤</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞</label>
                <select class="input-field" id="bookingType">
                    <option value="new">‚ú® –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</option>
                    <option value="returning">üîÑ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                <input type="text" class="input-field" id="bookingName" placeholder="–ò–º—è">
            </div>

            <div class="input-group">
                <label class="input-label">–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—É–º–º–∞ (z≈Ç)</label>
                <input type="number" class="input-field" id="bookingAmount" placeholder="0">
            </div>

            <button class="btn-primary" onclick="saveBooking()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ó–∞–ø–∏—Å—å</button>
        </div>
    </div>

    <!-- Add Reward Modal -->
    <div class="modal" id="addRewardModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">–ù–æ–≤–∞—è –ù–∞–≥—Ä–∞–¥–∞</span>
                <button class="modal-close" onclick="closeModal('addRewardModal')">‚úï</button>
            </div>

            <div class="input-group">
                <label class="input-label">–ß—Ç–æ —Ö–æ—á–µ—à—å –∫—É–ø–∏—Ç—å?</label>
                <input type="text" class="input-field" id="rewardName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã">
            </div>

            <div class="input-group">
                <label class="input-label">–¶–µ–Ω–∞ (z≈Ç)</label>
                <input type="number" class="input-field" id="rewardPrice" placeholder="0">
            </div>

            <div class="input-group">
                <label class="input-label">–ó–∞ –∫–∞–∫—É—é —Ü–µ–ª—å?</label>
                <select class="input-field" id="rewardGoal">
                    <option value="weekly">üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Ü–µ–ª—å</option>
                    <option value="monthly">üìÜ –ú–µ—Å—è—á–Ω–∞—è —Ü–µ–ª—å</option>
                    <option value="debt">üí∞ –í—ã–ø–ª–∞—Ç–∞ –¥–æ–ª–≥–∞</option>
                    <option value="custom">üéØ –û—Å–æ–±–∞—è —Ü–µ–ª—å</option>
                </select>
            </div>

            <button class="btn-primary" onclick="saveReward()">üéÅ –î–æ–±–∞–≤–∏—Ç—å –ù–∞–≥—Ä–∞–¥—É</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div style="margin-bottom: 10px;"><strong>–£—Å—Ç–∞–Ω–æ–≤–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω!</strong></div>
        <div style="font-size: 12px; margin-bottom: 10px;">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –≤–Ω–∏–∑—É, –∑–∞—Ç–µ–º "–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π"</div>
        <button class="btn-primary" onclick="hideInstallPrompt()" style="margin: 0;">–ü–æ–Ω—è—Ç–Ω–æ!</button>
    </div>

    <script>
        // Global State
        let appData = {
            bloodPoints: 0,
            balance: 0,
            piggyBanks: [
                { id: 'cushion', name: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ü–æ–¥—É—à–∫–∞', amount: 0, goal: 5000 },
                { id: 'nextRent', name: '–°–ª–µ–¥—É—é—â–∞—è –ê—Ä–µ–Ω–¥–∞', amount: 0, goal: 3000 },
                { id: 'debt', name: '–î–æ–ª–≥–∏', amount: 0, goal: 0 },
                { id: 'teeth', name: '–õ–µ—á–µ–Ω–∏–µ –ó—É–±–æ–≤', amount: 0, goal: 3000 },
                { id: 'drawing', name: '–®–∫–æ–ª–∞ –†–∏—Å—É–Ω–∫–∞', amount: 0, goal: 800 }
            ],
            quests: [],
            bookings: [],
            diary: [],
            rewards: [],
            stats: {
                weekIncome: 0,
                weekExpense: 0,
                questsCompleted: 0,
                totalSteps: 0,
                daysRecorded: 0
            },
            currentMood: 'okay',
            lastQuestReset: {
                '4h': null,
                'daily': null,
                'weekly': null
            }
        };

        // Initialize
        window.onload = function() {
            loadData();
            initializeQuests();
            renderAll();
            setupNotifications();
            showInstallPromptIfNeeded();
            startQuestTimer();
        };

        function loadData() {
            const saved = localStorage.getItem('gothicLifeAssistant');
            if (saved) {
                const parsed = JSON.parse(saved);
                appData = { ...appData, ...parsed };
            }
        }

        function saveData() {
            localStorage.setItem('gothicLifeAssistant', JSON.stringify(appData));
        }

        function initializeQuests() {
            const now = new Date();
            
            // 4-hour quests
            const quests4h = [
                {
                    id: 'content_check',
                    title: '–ü—Ä–æ–≤–µ—Ä—å –°–æ–æ–±—â–µ–Ω–∏—è',
                    description: '–ü—Ä–æ–≤–µ—Ä—å Instagram –∏ SMS –Ω–∞ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã',
                    hint: '–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç = –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤',
                    reward: 10,
                    period: '4h',
                    timeLimit: 15,
                    completed: false
                },
                {
                    id: 'post_dates',
                    title: '–ü–æ—Å—Ç –æ –°–≤–æ–±–æ–¥–Ω—ã—Ö –î–∞—Ç–∞—Ö',
                    description: '–û–ø—É–±–ª–∏–∫—É–π —Å—Ç–æ—Ä–∏—Å –∏–ª–∏ –ø–æ—Å—Ç –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –¥–∞—Ç–∞—Ö',
                    hint: '–ò—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω: "–°–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ: [–¥–∞—Ç—ã]"',
                    reward: 15,
                    period: '4h',
                    timeLimit: 15,
                    completed: false
                }
            ];

            // Daily quests
            const questsDaily = [
                {
                    id: 'sketch_practice',
                    title: '–ü—Ä–∞–∫—Ç–∏–∫–∞ –†–∏—Å—É–Ω–∫–∞',
                    description: '–ü–æ—Ä–∞–±–æ—Ç–∞–π –Ω–∞–¥ —ç—Å–∫–∏–∑–æ–º 2+ —á–∞—Å–∞',
                    hint: '–¢–µ–º–∞ –¥–Ω—è: –ö–∏–Ω–∂–∞–ª—ã –∏ –º–µ—á–∏',
                    reward: 30,
                    period: 'daily',
                    timeLimit: 0,
                    completed: false
                },
                {
                    id: 'stable_diffusion',
                    title: 'AI –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã',
                    description: '–°–æ–∑–¥–∞–π 5 —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ –≤ Stable Diffusion',
                    hint: '–ü–æ–ø—Ä–æ–±—É–π –Ω–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —á–µ—Ä–Ω–æ-–±–µ–ª–æ–π –≥—Ä–∞—Ñ–∏–∫–∏',
                    reward: 20,
                    period: 'daily',
                    timeLimit: 0,
                    completed: false
                },
                {
                    id: 'promotion_hour',
                    title: '–ß–∞—Å –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è',
                    description: '–ü–æ—Ç—Ä–∞—Ç—å 1 —á–∞—Å –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö',
                    hint: '–ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–π, –ª–∞–π–∫–∞–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π —Å –≤–∞—Ä—à–∞–≤—Å–∫–∏–º —Ç–∞—Ç—É-–∫–æ–º—å—é–Ω–∏—Ç–∏',
                    reward: 25,
                    period: 'daily',
                    timeLimit: 0,
                    completed: false
                }
            ];

            // Weekly quests
            const questsWeekly = [
                {
                    id: 'portfolio_update',
                    title: '–û–±–Ω–æ–≤–∏ –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ',
                    description: '–î–æ–±–∞–≤—å 3 –ª—É—á—à–∏—Ö —Ä–∞–±–æ—Ç—ã –Ω–µ–¥–µ–ª–∏ –≤ Instagram',
                    hint: '–•–æ—Ä–æ—à–∏–µ —Ñ–æ—Ç–æ = –±–æ–ª—å—à–µ –∑–∞–ø–∏—Å–µ–π',
                    reward: 50,
                    period: 'weekly',
                    timeLimit: 0,
                    completed: false
                },
                {
                    id: 'warsaw_promo',
                    title: '–í–∞—Ä—à–∞–≤—Å–∫–æ–µ –ü—Ä–æ–º–æ',
                    description: '–°–¥–µ–ª–∞–π —Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ä–µ–∫–ª–∞–º—É –Ω–∞ –í–∞—Ä—à–∞–≤—É',
                    hint: '–ò—Å–ø–æ–ª—å–∑—É–π ChatGPT –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è',
                    reward: 60,
                    period: 'weekly',
                    timeLimit: 0,
                    completed: false
                },
                {
                    id: 'weekly_report',
                    title: '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –û—Ç—á–µ—Ç',
                    description: '–ó–∞–ø–æ–ª–Ω–∏ –Ω–µ–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ü–µ–ª–∏',
                    hint: '–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ (–¥–µ–º–æ–Ω—É) –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å',
                    reward: 40,
                    period: 'weekly',
                    timeLimit: 0,
                    completed: false
                }
            ];

            // Check if quests need to be reset
            if (shouldResetQuests('4h')) {
                appData.quests = appData.quests.filter(q => q.period !== '4h');
                appData.quests = [...appData.quests, ...quests4h];
                appData.lastQuestReset['4h'] = now.getTime();
            }

            if (shouldResetQuests('daily')) {
                appData.quests = appData.quests.filter(q => q.period !== 'daily');
                appData.quests = [...appData.quests, ...questsDaily];
                appData.lastQuestReset['daily'] = now.getTime();
            }

            if (shouldResetQuests('weekly')) {
                appData.quests = appData.quests.filter(q => q.period !== 'weekly');
                appData.quests = [...appData.quests, ...questsWeekly];
                appData.lastQuestReset['weekly'] = now.getTime();
            }

            // If no quests at all, add them
            if (appData.quests.length === 0) {
                appData.quests = [...quests4h, ...questsDaily, ...questsWeekly];
                appData.lastQuestReset = {
                    '4h': now.getTime(),
                    'daily': now.getTime(),
                    'weekly': now.getTime()
                };
            }
        }

        function shouldResetQuests(period) {
            if (!appData.lastQuestReset[period]) return true;
            
            const now = new Date();
            const lastReset = new Date(appData.lastQuestReset[period]);
            
            if (period === '4h') {
                const hours = (now - lastReset) / (1000 * 60 * 60);
                return hours >= 4;
            } else if (period === 'daily') {
                return now.getDate() !== lastReset.getDate();
            } else if (period === 'weekly') {
                const days = (now - lastReset) / (1000 * 60 * 60 * 24);
                return days >= 7;
            }
        }

        function startQuestTimer() {
            // Check every minute for quest resets
            setInterval(() => {
                initializeQuests();
                renderQuests();
            }, 60000);
        }

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const screen = tab.dataset.screen;
                switchScreen(screen);
            });
        });

        function switchScreen(screenName) {
            // Update tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-screen="${screenName}"]`).classList.add('active');
            
            // Update screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenName).classList.add('active');
        }

        // Quest tabs
        document.querySelectorAll('.quest-tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.quest-tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderQuests(btn.dataset.period);
            });
        });

        // Render Functions
        function renderAll() {
            renderQuests();
            renderFinance();
            renderCalendar();
            renderDiary();
            renderRewards();
            renderStats();
            updateBloodPoints();
        }

        function renderQuests(period = '4h') {
            const questsList = document.getElementById('questsList');
            const filteredQuests = appData.quests.filter(q => q.period === period);
            
            questsList.innerHTML = filteredQuests.map(quest => `
                <div class="quest-card ${quest.completed ? 'completed' : ''}">
                    <div class="quest-header">
                        <div class="quest-title">${quest.title}</div>
                        ${quest.timeLimit > 0 ? `<div class="quest-timer">‚è±Ô∏è ${quest.timeLimit} –º–∏–Ω</div>` : ''}
                    </div>
                    <div class="quest-description">${quest.description}</div>
                    <div class="quest-hint">üí° ${quest.hint}</div>
                    <div class="quest-reward">
                        <div class="reward-text">ü©∏ +${quest.reward} –æ—á–∫–æ–≤</div>
                        <button class="quest-complete-btn ${quest.completed ? 'completed' : ''}" 
                                onclick="completeQuest('${quest.id}')" 
                                ${quest.completed ? 'disabled' : ''}>
                            ${quest.completed ? '‚úì –ì–æ—Ç–æ–≤–æ' : '‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function completeQuest(questId) {
            const quest = appData.quests.find(q => q.id === questId);
            if (quest && !quest.completed) {
                quest.completed = true;
                appData.bloodPoints += quest.reward;
                appData.stats.questsCompleted++;
                
                showNotification(`üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${quest.reward} –∫—Ä–æ–≤–∞–≤—ã—Ö –æ—á–∫–æ–≤!`);
                saveData();
                renderQuests();
                updateBloodPoints();
                renderStats();
            }
        }

        function renderFinance() {
            document.getElementById('currentBalance').textContent = appData.balance.toFixed(0);
            
            const piggyBanksList = document.getElementById('piggyBanksList');
            piggyBanksList.innerHTML = appData.piggyBanks.map(bank => {
                const progress = bank.goal > 0 ? (bank.amount / bank.goal * 100).toFixed(0) : 0;
                return `
                    <div class="piggy-bank">
                        <div class="piggy-header">
                            <span class="piggy-name">${bank.name}</span>
                            <span class="piggy-amount">${bank.amount.toFixed(0)} ${bank.goal > 0 ? `/ ${bank.goal}` : ''} z≈Ç</span>
                        </div>
                        ${bank.goal > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function addIncome() {
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const source = document.getElementById('incomeSource').value;
            
            if (!amount || amount <= 0) {
                showNotification('‚ö†Ô∏è –í–≤–µ–¥–∏ —Å—É–º–º—É –¥–æ—Ö–æ–¥–∞!');
                return;
            }

            // Calculate commission and transport costs
            let netIncome = amount;
            if (source === 'warsaw') {
                netIncome = amount * 0.6; // 40% commission
            } else if (source === 'sochaczew') {
                netIncome = amount * 0.7 - 100; // 30% commission + 100 z≈Ç transport
            }

            appData.balance += netIncome;
            appData.stats.weekIncome += netIncome;

            // Smart distribution
            const distribution = calculateDistribution(netIncome);
            showDistributionModal(distribution);

            document.getElementById('incomeAmount').value = '';
            saveData();
        }

        function calculateDistribution(income) {
            const distribution = {};
            let remaining = income;

            // Priority 1: Next rent if not covered
            const rentBank = appData.piggyBanks.find(b => b.id === 'nextRent');
            if (rentBank.amount < rentBank.goal) {
                const needed = rentBank.goal - rentBank.amount;
                const toRent = Math.min(needed, remaining * 0.3);
                distribution['nextRent'] = toRent;
                remaining -= toRent;
            }

            // Priority 2: Cushion (if less than goal)
            const cushionBank = appData.piggyBanks.find(b => b.id === 'cushion');
            if (cushionBank.amount < cushionBank.goal) {
                const toCushion = remaining * 0.4;
                distribution['cushion'] = toCushion;
                remaining -= toCushion;
            }

            // Priority 3: Debt (400-700 z≈Ç per payment)
            if (remaining > 400) {
                const toDebt = Math.min(700, remaining * 0.3);
                distribution['debt'] = toDebt;
                remaining -= toDebt;
            }

            // Priority 4: Drawing school / teeth
            if (remaining > 0) {
                const teethBank = appData.piggyBanks.find(b => b.id === 'teeth');
                const drawingBank = appData.piggyBanks.find(b => b.id === 'drawing');
                
                if (drawingBank.amount < drawingBank.goal) {
                    distribution['drawing'] = remaining * 0.5;
                    remaining -= distribution['drawing'];
                }
                
                if (remaining > 0 && teethBank.amount < teethBank.goal) {
                    distribution['teeth'] = remaining;
                }
            }

            return distribution;
        }

        function showDistributionModal(distribution) {
            let message = 'üí∞ –†–µ–∫–æ–º–µ–Ω–¥—É—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∞–∫:\n\n';
            for (const [bankId, amount] of Object.entries(distribution)) {
                const bank = appData.piggyBanks.find(b => b.id === bankId);
                message += `${bank.name}: ${amount.toFixed(0)} z≈Ç\n`;
                bank.amount += amount;
            }
            
            showNotification(message);
            renderFinance();
            saveData();
        }

        function addExpense() {
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const category = document.getElementById('expenseCategory').value;
            const note = document.getElementById('expenseNote').value;
            
            if (!amount || amount <= 0) {
                showNotification('‚ö†Ô∏è –í–≤–µ–¥–∏ —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–∞!');
                return;
            }

            appData.balance -= amount;
            appData.stats.weekExpense += amount;

            // Record expense
            appData.expenses = appData.expenses || [];
            appData.expenses.push({
                amount,
                category,
                note,
                date: new Date().toISOString()
            });

            showNotification(`üí∏ –†–∞—Å—Ö–æ–¥ –∑–∞–ø–∏—Å–∞–Ω: ${amount} z≈Ç`);
            
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseNote').value = '';
            
            saveData();
            renderFinance();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let html = '';
            
            // Week day headers
            ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].forEach(day => {
                html += `<div class="calendar-day" style="font-weight: bold; background: rgba(139,0,0,0.2)">${day}</div>`;
            });
            
            // Empty cells
            for (let i = 1; i < firstDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasBooking = appData.bookings.some(b => b.date === dateStr);
                
                html += `
                    <div class="calendar-day ${hasBooking ? 'has-booking' : ''}" onclick="showDayDetails('${dateStr}')">
                        <div class="calendar-day-num">${day}</div>
                        ${hasBooking ? '<div class="calendar-day-dot"></div>' : ''}
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }

        function showBookingModal() {
            document.getElementById('bookingModal').classList.add('active');
            document.getElementById('bookingDate').value = new Date().toISOString().split('T')[0];
        }

        function saveBooking() {
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const city = document.getElementById('bookingCity').value;
            const type = document.getElementById('bookingType').value;
            const name = document.getElementById('bookingName').value;
            const amount = parseFloat(document.getElementById('bookingAmount').value);
            
            if (!date || !time || !name) {
                showNotification('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            appData.bookings.push({
                date,
                time,
                city,
                type,
                name,
                amount,
                id: Date.now()
            });

            showNotification(`‚úì –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞: ${name} –Ω–∞ ${date}`);
            closeModal('bookingModal');
            renderCalendar();
            saveData();
        }

        function renderDiary() {
            const history = document.getElementById('diaryHistory');
            const recent = appData.diary.slice(-7).reverse();
            
            history.innerHTML = recent.map(entry => `
                <div class="diary-entry">
                    <div class="diary-date">${new Date(entry.date).toLocaleDateString('ru-RU')} ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${getMoodEmoji(entry.mood)} ‚Ä¢ –¢—Ä–µ–≤–æ–≥–∞: ${entry.anxiety}/10</div>
                    <div class="diary-content">${entry.text}</div>
                    ${entry.steps ? `<div style="margin-top: 10px; color: #999; font-size: 12px;">üëü –®–∞–≥–æ–≤: ${entry.steps}</div>` : ''}
                </div>
            `).join('');
        }

        function selectMood(mood) {
            appData.currentMood = mood;
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-mood="${mood}"]`).classList.add('selected');
        }

        function saveDiary() {
            const text = document.getElementById('diaryText').value;
            const anxiety = parseInt(document.getElementById('anxietyLevel').value);
            const steps = parseInt(document.getElementById('stepsInput').value) || 0;
            
            if (!text) {
                showNotification('‚ö†Ô∏è –ù–∞–ø–∏—à–∏ —Ö–æ—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                return;
            }

            appData.diary.push({
                date: new Date().toISOString(),
                mood: appData.currentMood,
                text,
                anxiety,
                steps
            });

            if (steps > 0) {
                appData.stats.totalSteps += steps;
                appData.stats.daysRecorded++;
            }

            showNotification('üíæ –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            
            document.getElementById('diaryText').value = '';
            document.getElementById('stepsInput').value = '';
            renderDiary();
            renderStats();
            saveData();
        }

        function renderRewards() {
            const list = document.getElementById('rewardsList');
            
            if (appData.rewards.length === 0) {
                list.innerHTML = '<div class="demon-message"><p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞–≥—Ä–∞–¥. –î–æ–±–∞–≤—å —á—Ç–æ-–Ω–∏–±—É–¥—å, —á—Ç–æ —Ö–æ—á–µ—à—å –∫—É–ø–∏—Ç—å!</p></div>';
                return;
            }

            list.innerHTML = appData.rewards.map(reward => {
                const canAfford = appData.balance >= reward.price;
                return `
                    <div class="reward-item">
                        <div class="reward-info">
                            <div class="reward-name">${reward.name}</div>
                            <div class="reward-price">${reward.price} z≈Ç</div>
                        </div>
                        <div class="reward-status">
                            ${canAfford ? '‚úì –ú–æ–∂–µ—à—å –∫—É–ø–∏—Ç—å!' : `–ï—â–µ ${(reward.price - appData.balance).toFixed(0)} z≈Ç`}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAddRewardModal() {
            document.getElementById('addRewardModal').classList.add('active');
        }

        function saveReward() {
            const name = document.getElementById('rewardName').value;
            const price = parseFloat(document.getElementById('rewardPrice').value);
            const goal = document.getElementById('rewardGoal').value;
            
            if (!name || !price) {
                showNotification('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            appData.rewards.push({ name, price, goal, id: Date.now() });
            
            showNotification('üéÅ –ù–∞–≥—Ä–∞–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            closeModal('addRewardModal');
            renderRewards();
            saveData();
        }

        function renderStats() {
            document.getElementById('weekIncome').textContent = appData.stats.weekIncome.toFixed(0);
            document.getElementById('weekExpense').textContent = appData.stats.weekExpense.toFixed(0);
            document.getElementById('questsCompleted').textContent = appData.stats.questsCompleted;
            
            const avgSteps = appData.stats.daysRecorded > 0 
                ? Math.round(appData.stats.totalSteps / appData.stats.daysRecorded)
                : 0;
            document.getElementById('avgSteps').textContent = avgSteps;

            // Update goal progress
            const cushion = appData.piggyBanks.find(b => b.id === 'cushion');
            document.getElementById('cushionAmount').textContent = cushion.amount.toFixed(0);
            document.getElementById('cushionProgress').style.width = `${(cushion.amount / cushion.goal * 100).toFixed(0)}%`;

            const debt = appData.piggyBanks.find(b => b.id === 'debt');
            document.getElementById('debtPaid').textContent = debt.amount.toFixed(0);
        }

        function updateBloodPoints() {
            document.getElementById('bloodPoints').textContent = appData.bloodPoints;
        }

        // Utility Functions
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function getMoodEmoji(mood) {
            const moods = {
                terrible: 'üò≠',
                bad: 'üòî',
                okay: 'üòê',
                good: 'üôÇ',
                great: 'üòÑ'
            };
            return moods[mood] || 'üòê';
        }

        // Anxiety slider
        document.getElementById('anxietyLevel').addEventListener('input', (e) => {
            document.getElementById('anxietyDisplay').textContent = e.target.value;
        });

        // Notifications
        function setupNotifications() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function showInstallPromptIfNeeded() {
            // Show install prompt on iOS if not installed
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isStandalone = window.navigator.standalone;
            
            if (isIOS && !isStandalone) {
                setTimeout(() => {
                    document.getElementById('installPrompt').classList.add('show');
                }, 3000);
            }
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
        }

        function generateWeeklyReport() {
            const report = `
                üìä –ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–´–ô –û–¢–ß–ï–¢
                
                üí∞ –§–∏–Ω–∞–Ω—Å—ã:
                - –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${appData.stats.weekIncome.toFixed(0)} z≈Ç
                - –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: ${appData.stats.weekExpense.toFixed(0)} z≈Ç
                - –ë–∞–ª–∞–Ω—Å: ${appData.balance.toFixed(0)} z≈Ç
                
                ‚öîÔ∏è –ó–∞–¥–∞–Ω–∏—è:
                - –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${appData.stats.questsCompleted}
                - –ö—Ä–æ–≤–∞–≤—ã—Ö –æ—á–∫–æ–≤: ${appData.bloodPoints}
                
                üéØ –ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª—è–º:
                - –§–∏–Ω–ø–æ–¥—É—à–∫–∞: ${appData.piggyBanks[0].amount.toFixed(0)} / 5000 z≈Ç
                - –î–æ–ª–≥–∏: ${appData.piggyBanks[2].amount.toFixed(0)} z≈Ç –≤—ã–ø–ª–∞—á–µ–Ω–æ
                
                üëü –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
                - –°—Ä–µ–¥–Ω–∏–µ —à–∞–≥–∏: ${appData.stats.daysRecorded > 0 ? Math.round(appData.stats.totalSteps / appData.stats.daysRecorded) : 0}
                
                –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ, —Å–º–µ—Ä—Ç–Ω—ã–π!
            `;
            
            showNotification('üìä –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
            alert(report);
        }

        function showDayDetails(dateStr) {
            const bookings = appData.bookings.filter(b => b.date === dateStr);
            if (bookings.length > 0) {
                const details = bookings.map(b => 
                    `${b.time} - ${b.name} (${b.city === 'warsaw' ? '–í–∞—Ä—à–∞–≤–∞' : '–°–æ—Ö–∞—á–µ–≤'})`
                ).join('\n');
                alert(`üìÖ ${dateStr}\n\n${details}`);
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {
                // Service worker registration failed silently
            });
        }
    </script>
</body>
</html>